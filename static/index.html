<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Config Manager - Production Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>


    <div class="container">
        <header>
            <div class="header-left">
                <h1>Config Manager</h1>
                <p>Centralized configuration management for your services</p>
            </div>
            <div class="header-right">
                <div id="userInfo" class="user-info" style="display: none;">
                    <span id="userName">Loading...</span>
                    <button onclick="logout()" class="btn btn-secondary btn-sm">Logout</button>
                </div>
                <div id="authButtons" class="auth-buttons">
                    <button onclick="showLoginModal()" class="btn btn-secondary btn-sm">Login</button>
                    <button onclick="showRegisterModal()" class="btn btn-primary btn-sm">Register</button>
                </div>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>API Connected</span>
                </div>
            </div>
        </header>

        <div class="main-layout">
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Quick Stats -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Overview</h3>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalConfigs">-</div>
                            <div class="stat-label">Total Configs</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalServices">-</div>
                            <div class="stat-label">Services</div>
                        </div>
                    </div>
                </div>

                <!-- Create Configuration -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">New Configuration</h3>
                        <p class="card-subtitle">Add configuration for a service</p>
                    </div>
                    <form id="createForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="serviceName">Service Name</label>
                                <input type="text" id="serviceName" placeholder="user-service" required>
                            </div>
                            <div class="form-group">
                                <label for="envName">Environment</label>
                                <div class="env-input-container">
                                    <select id="envName" onchange="handleEnvSelection(this)">
                                        <option value="">Select or create environment...</option>
                                        <option value="__custom__">+ Create New Environment</option>
                                        <!-- Existing environments will be populated here -->
                                    </select>
                                    <input type="text" id="customEnvName" placeholder="Enter new environment name"
                                        style="display: none;" onblur="handleCustomEnvBlur()">
                                </div>
                                <div class="env-suggestions">
                                    <small>Common:
                                        <span class="env-suggestion" onclick="selectEnvSuggestion('dev')">dev</span>,
                                        <span class="env-suggestion" onclick="selectEnvSuggestion('test')">test</span>,
                                        <span class="env-suggestion"
                                            onclick="selectEnvSuggestion('staging')">staging</span>,
                                        <span class="env-suggestion"
                                            onclick="selectEnvSuggestion('production')">production</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="configPairs">Configuration Variables</label>
                            <div id="configPairs" class="config-pairs">
                                <!-- Dynamic key-value pairs will be added here -->
                            </div>
                            <button type="button" onclick="addConfigPair()" class="btn btn-secondary btn-sm"
                                style="margin-top: 8px;">
                                + Add Variable
                            </button>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            Create Configuration
                        </button>
                    </form>
                </div>

                <!-- Quick Filters -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Quick Filters</h3>
                    </div>
                    <div class="button-group" style="flex-direction: column;">
                        <button onclick="filterByEnv('dev')" class="btn btn-secondary">
                            Development Only
                        </button>
                        <button onclick="filterByEnv('stage')" class="btn btn-secondary">
                            Staging Only
                        </button>
                        <button onclick="filterByEnv('prod')" class="btn btn-secondary">
                            Production Only
                        </button>
                        <button onclick="clearFilters()" class="btn btn-secondary">
                            Show All
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <div class="content-header">
                    <h2 class="content-title">Configurations</h2>
                    <div class="content-actions">
                        <button onclick="handleRefreshClick()" class="btn btn-secondary">
                            Refresh
                        </button>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="search-bar">
                    <div class="form-group search-input">
                        <input type="text" id="searchService" placeholder="Search by service name...">
                    </div>
                    <div class="form-group filter-select">
                        <select id="searchEnv">
                            <option value="">All Environments</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    <button onclick="searchConfigs()" class="btn btn-primary">
                        Search
                    </button>
                </div>

                <!-- Configurations List -->
                <div class="configs-container">
                    <div class="configs-header">
                        <div>Service</div>
                        <div>Environment</div>
                        <div>Configuration</div>
                        <div>Actions</div>
                    </div>
                    <div id="configsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">‚öôÔ∏è</div>
                            <h3>No configurations yet</h3>
                            <p>Create your first configuration using the form on the left, or click "Refresh" to load
                                existing configurations.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Status Messages -->
        <div id="statusMessage" class="status-message"></div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Configuration</h3>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <input type="hidden" id="editConfigId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editServiceName">Service Name</label>
                            <input type="text" id="editServiceName" required>
                        </div>
                        <div class="form-group">
                            <label for="editEnvName">Environment</label>
                            <div class="env-input-container">
                                <select id="editEnvName" onchange="handleEditEnvSelection(this)">
                                    <option value="">Select or create environment...</option>
                                    <option value="__custom__">+ Create New Environment</option>
                                    <!-- Existing environments will be populated here -->
                                </select>
                                <input type="text" id="editCustomEnvName" placeholder="Enter new environment name"
                                    style="display: none;" onblur="handleEditCustomEnvBlur()">
                            </div>
                            <div class="env-suggestions">
                                <small>Common:
                                    <span class="env-suggestion" onclick="selectEditEnvSuggestion('dev')">dev</span>,
                                    <span class="env-suggestion" onclick="selectEditEnvSuggestion('test')">test</span>,
                                    <span class="env-suggestion"
                                        onclick="selectEditEnvSuggestion('staging')">staging</span>,
                                    <span class="env-suggestion"
                                        onclick="selectEditEnvSuggestion('production')">production</span>
                                </small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editConfigPairs">Configuration Variables</label>
                        <div id="editConfigPairs" class="config-pairs">
                            <!-- Dynamic key-value pairs will be added here -->
                        </div>
                        <button type="button" onclick="addEditConfigPair()" class="btn btn-secondary btn-sm"
                            style="margin-top: 8px;">
                            + Add Variable
                        </button>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">
                            Update Configuration
                        </button>
                        <button type="button" onclick="closeEditModal()" class="btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Login</h3>
                <button class="modal-close" onclick="closeLoginModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- OAuth Login Buttons -->
                <div class="oauth-section">
                    <button onclick="loginWithGoogle()" class="btn btn-oauth btn-google">
                        <svg width="18" height="18" viewBox="0 0 18 18">
                            <path fill="#4285F4"
                                d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 0 0 2.38-5.88c0-.57-.05-.66-.15-1.18z" />
                            <path fill="#34A853"
                                d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2a4.8 4.8 0 0 1-7.18-2.54H1.83v2.07A8 8 0 0 0 8.98 17z" />
                            <path fill="#FBBC05"
                                d="M4.5 10.52a4.8 4.8 0 0 1 0-3.04V5.41H1.83a8 8 0 0 0 0 7.18l2.67-2.07z" />
                            <path fill="#EA4335"
                                d="M8.98 4.18c1.17 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 0 0 1.83 5.4L4.5 7.49a4.77 4.77 0 0 1 4.48-3.3z" />
                        </svg>
                        Continue with Google
                    </button>
                </div>

                <div class="divider">
                    <span>OR</span>
                </div>

                <!-- Email/Password Login -->
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <div class="password-input-container">
                            <input type="password" id="loginPassword" required placeholder="Enter your password">
                            <button type="button" class="password-toggle"
                                onclick="togglePasswordVisibility('loginPassword')" title="Show/Hide Password">
                                üëÅÔ∏è
                            </button>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            Login
                        </button>
                        <button type="button" onclick="closeLoginModal()" class="btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </form>
                <div style="text-align: center; margin-top: 16px;">
                    <small style="color: var(--text-secondary);">
                        Don't have an account?
                        <a href="#" onclick="closeLoginModal(); showRegisterModal();"
                            style="color: var(--accent-secondary);">Register here</a>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Account</h3>
                <button class="modal-close" onclick="closeRegisterModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- OAuth Register Buttons -->
                <div class="oauth-section">
                    <button onclick="loginWithGoogle()" class="btn btn-oauth btn-google">
                        <svg width="18" height="18" viewBox="0 0 18 18">
                            <path fill="#4285F4"
                                d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 0 0 2.38-5.88c0-.57-.05-.66-.15-1.18z" />
                            <path fill="#34A853"
                                d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2a4.8 4.8 0 0 1-7.18-2.54H1.83v2.07A8 8 0 0 0 8.98 17z" />
                            <path fill="#FBBC05"
                                d="M4.5 10.52a4.8 4.8 0 0 1 0-3.04V5.41H1.83a8 8 0 0 0 0 7.18l2.67-2.07z" />
                            <path fill="#EA4335"
                                d="M8.98 4.18c1.17 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 0 0 1.83 5.4L4.5 7.49a4.77 4.77 0 0 1 4.48-3.3z" />
                        </svg>
                        Continue with Google
                    </button>
                </div>

                <div class="divider">
                    <span>OR</span>
                </div>

                <!-- Email/Password Register -->
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" required placeholder="John Doe">
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <div class="password-input-container">
                            <input type="password" id="registerPassword" required placeholder="At least 8 characters">
                            <button type="button" class="password-toggle"
                                onclick="togglePasswordVisibility('registerPassword')" title="Show/Hide Password">
                                üëÅÔ∏è
                            </button>
                        </div>
                        <small style="color: var(--text-muted); font-size: 0.75rem;">
                            Password must be at least 8 characters long
                        </small>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            Create Account
                        </button>
                        <button type="button" onclick="closeRegisterModal()" class="btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </form>
                <div style="text-align: center; margin-top: 16px;">
                    <small style="color: var(--text-secondary);">
                        Already have an account?
                        <a href="#" onclick="closeRegisterModal(); showLoginModal();"
                            style="color: var(--accent-secondary);">Login here</a>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/script.js?v=3"></script>
</body>

</html>